const g=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}};g();class d{constructor(t){this.position=t}update(t){}keyboard_event_down(t){}keyboard_event_up(t){}draw(t,e){}}var y="/canvas-car/assets/pacman.0e51210e.png";class w extends d{constructor(t,e="yellow",a=100){super(t),this.pacmanSize=40,this.mouthOpen=30,this.origin={x:t.x,y:t.y},this.color=e,this.maxSpeed=a,this.speed={x:a,y:0},this.image=new Image,this.image.src=y,this.sxParameters=[7,6,5,4,5,6],this.timer=0,this.xFrame=0,this.yFrame=5}update(t){this.mouthOpen+=.8;let e=this.origin.x+this.speed.x*t;e<=1024-this.pacmanSize&&e>=this.pacmanSize&&(this.origin.x=e),this.timer+=t,this.timer>=.1&&(this.xFrame=(this.xFrame+1)%6,this.timer=0)}draw(t,e){let a=this.origin;this.speed.x!=0&&this.speed.x<0,e.translate(a.x,a.y),e.drawImage(this.image,32.5*this.sxParameters[this.xFrame],31*this.yFrame,25,25,0,0,this.pacmanSize,this.pacmanSize)}keyboard_event_down(t){switch(t){case"ArrowRight":console.log("right"),this.speed.x=this.maxSpeed,this.yFrame=5;break;case"ArrowLeft":console.log("left"),this.speed.x=-this.maxSpeed,this.yFrame=4;break;case"ArrowUp":console.log("up");break;case"ArrowDown":console.log("down");break;default:console.log("not a valid key");break}}}class b extends d{draw(t,e){const a=(1/t).toFixed(2);e.font="50px Arial",e.fillStyle="black",e.fillText(`FPS: ${a}`,this.position.x,this.position.y)}}const n=r=>r*Math.PI/180,m=r=>r.x<1024&&r.x>0&&r.y>0&&r.y<1024;var h=(r=>(r[r.UP=0]="UP",r[r.DOWN=1]="DOWN",r[r.LEFT=2]="LEFT",r[r.RIGHT=3]="RIGHT",r))(h||{});const A={ArrowUp:0,ArrowDown:1,ArrowLeft:2,ArrowRight:3};var x="/canvas-car/assets/ferrari.27cefde0.png";const S=new URL("/canvas-car/assets/carAccelerating.fd31df32.mp3",self.location);class k extends d{constructor(t,e,a={w:50,h:100}){super(t),this.carSize=a,this.carColor="red",this.angle=0,this.angleSpeed=0,this.carSpeed=0,this.carAcceleration=0,this.carImage=new Image,this.carImage.src=x,this.keyboardMap=e,this.carAudio=new Audio(S.toString()),this.carAudio.volume=.5}update(t){this.angle+=this.angleSpeed,this.angleSpeed*=.9,this.carSpeed=this.carSpeed*.9+this.carAcceleration;let e={x:this.position.x+Math.cos(n(this.angle))*this.carSpeed,y:this.position.y+Math.sin(n(this.angle))*this.carSpeed};m(e)&&(this.position=e),this.carAcceleration>0&&m(e)?(this.carAudio.volume=1,this.carAudio.play()):this.carAudio.volume=0}draw(t,e){e.translate(this.position.x,this.position.y),e.rotate(n(this.angle)),e.fillStyle=this.carColor,e.rotate(n(180)),e.drawImage(this.carImage,-this.carSize.h/2,-this.carSize.w/2,this.carSize.h,this.carSize.w)}keyboard_event_down(t){let e=this.keyboardMap[t];e===h.LEFT?this.angleSpeed-=4:e===h.RIGHT?this.angleSpeed+=4:e===h.UP?this.carAcceleration=2:e===h.DOWN&&(this.carAcceleration=-2)}keyboard_event_up(t){let e=this.keyboardMap[t];e===h.UP?this.carAcceleration=0:e===h.DOWN&&(this.carAcceleration=0)}}class v extends d{constructor(t,e=100,a,i,s){super(t),this.barrierWidth=e,this.angle=a,this.actor=i,this.touched=!1,this.barrierIndex=s}update(t){let e=this.actor.position,a=this.position;Math.sqrt(Math.pow(a.x-e.x,2)+Math.pow(a.y-e.y,2))<50&&u.touchingBarrier(this.barrierIndex)&&(this.touched=!0)}draw(t,e){e.translate(this.position.x,this.position.y),e.rotate(n(this.angle)),e.strokeStyle=this.touched?"green":"red",e.lineWidth=1,e.beginPath(),e.moveTo(-this.barrierWidth/2,0),e.lineTo(this.barrierWidth/2,0),e.moveTo(0,0),e.arc(0,0,5,0,n(360)),e.closePath(),e.stroke(),e.fill()}}class L extends d{constructor(t){super({x:800,y:100}),this.currentBarrier=0,this.barriers=[],this.currentLap=0;let e={x:500,y:500},a=400,i=4;for(let s=0;s<i;s++){let o=360/i*s;this.barriers.push(new v({x:e.x+Math.sin(n(o))*a,y:e.y+Math.cos(n(o))*a},100,90-o,t,s))}}draw(t,e){e.font="50px Arial",e.fillStyle="black",e.fillText(`LAPS ${this.currentLap}/3`,this.position.x,this.position.y)}addLap(){console.log("Lap"),this.currentLap++,this.currentBarrier=0,this.barriers.forEach(t=>t.touched=!1),this.currentLap>2&&alert("You won")}touchingBarrier(t){return this.currentBarrier===t?(this.currentBarrier++,this.currentBarrier===this.barriers.length?(this.addLap(),!1):!0):!1}}let u;const F=r=>{u=new L(r)};window.onload=()=>{const r=document.getElementById("canvas"),t=r.getContext("2d");let e=new k({x:200,y:200},A);F(e);let a=[...u.barriers],i=[e],s=[new b({x:5,y:100}),...i,...a,u,new w({x:100,y:100})],o=0;const f=c=>{let l=(c-o)/1e3;o=c,s.forEach(p=>{p.update(l)}),t.clearRect(0,0,r.width,r.height),s.forEach(p=>{t.save(),p.draw(l,t),t.restore()}),window.requestAnimationFrame(f)};window.requestAnimationFrame(f),document.body.addEventListener("keydown",c=>{s.forEach(l=>{l.keyboard_event_down(c.key)})}),document.body.addEventListener("keyup",c=>{s.forEach(l=>{l.keyboard_event_up(c.key)})})};
